<!DOCTYPE html>
<html>
<head>
    <title>Complete Registration Test</title>
</head>
<body>
    <h1>Complete Registration Test</h1>
    <form id="testForm">
        <input type="text" id="firstName" placeholder="First Name" value="Test" required><br><br>
        <input type="text" id="lastName" placeholder="Last Name" value="Driver" required><br><br>
        <input type="text" id="username" placeholder="Username" value="test_driver" required><br><br>
        <input type="email" id="email" placeholder="Email" value="testdriver3@example.com" required><br><br>
        <input type="text" id="phone" placeholder="Phone" value="09123456784" required><br><br>
        <input type="password" id="password" placeholder="Password" value="Test123!" required><br><br>
        <input type="file" id="license" accept=".jpg,.jpeg,.png,.pdf" required><br><br>
        <button type="submit">Test Complete Registration</button>
    </form>
    
    <div id="result"></div>
    
    <script>
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('drivers_license', document.getElementById('license').files[0]);
            
            console.log('Step 1: Uploading driver license...');
            
            try {
                // Step 1: Upload license
                const uploadResponse = await fetch('http://192.168.254.110/LakbAI/LakbAI-API/routes/api.php/upload-driver-license', {
                    method: 'POST',
                    body: formData
                });
                
                const uploadResult = await uploadResponse.json();
                console.log('Upload result:', uploadResult);
                
                if (uploadResult.status !== 'success') {
                    document.getElementById('result').innerHTML = '<p style="color: red;">Upload failed: ' + uploadResult.message + '</p>';
                    return;
                }
                
                // Step 2: Register user
                const userData = {
                    first_name: document.getElementById('firstName').value,
                    last_name: document.getElementById('lastName').value,
                    username: document.getElementById('username').value,
                    email: document.getElementById('email').value,
                    phone_number: document.getElementById('phone').value,
                    password: document.getElementById('password').value,
                    confirmPassword: document.getElementById('password').value,
                    user_type: 'driver',
                    birthday: '1995-01-01',
                    house_number: '123',
                    street_name: 'Main St',
                    barangay: 'Barangay 1',
                    city_municipality: 'Manila',
                    province: 'Metro Manila',
                    postal_code: '1000',
                    gender: 'Male',
                    drivers_license: document.getElementById('license').files[0].name,
                    drivers_license_path: uploadResult.data.file_path,
                    drivers_license_verified: 0
                };
                
                console.log('Step 2: Registering user...');
                console.log('User data:', userData);
                
                const registerResponse = await fetch('http://192.168.254.110/LakbAI/LakbAI-API/routes/api.php/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                const registerResult = await registerResponse.json();
                console.log('Register result:', registerResult);
                
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(registerResult, null, 2) + '</pre>';
                
                // Step 3: Check pending approvals
                if (registerResult.status === 'success') {
                    console.log('Step 3: Checking pending approvals...');
                    const pendingResponse = await fetch('http://192.168.254.110/LakbAI/LakbAI-API/routes/api.php/admin/pending-approvals');
                    const pendingResult = await pendingResponse.json();
                    console.log('Pending approvals:', pendingResult);
                    
                    document.getElementById('result').innerHTML += '<h3>Pending Approvals:</h3><pre>' + JSON.stringify(pendingResult, null, 2) + '</pre>';
                }
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        });
    </script>
</body>
</html>
